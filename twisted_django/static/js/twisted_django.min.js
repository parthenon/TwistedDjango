function start_server(e,n,o,t){if("undefined"==typeof e&&(e="ws://"+window.location.hostname+":31415"),"undefined"==typeof o&&(o=!1),"undefined"==typeof t||0==t)var s=twistedsock(e,!1,o,!1,n);else if(t===!0)var s=twistedsock(e,!0,o,!1,n);return s}url_split=document.URL.split("/"),conf_id=url_split[url_split.length-1],twistedsock=function(e,n,o,t,s){function i(){r.close()}"undefined"==typeof o&&(o=!1),"undefined"==typeof t&&(t=!1),window.WEB_SOCKET_DEBUG=!0,window.WEB_SOCKET_SWF_LOCATION="/static/web-socket/WebSocketMain.swf",$(window).on("beforeunload",i);var r={},u={},c=[],d=!1,f=!1,a=!1,l=!1,p={};"undefined"!=typeof s&&(l=s),"undefined"==typeof o&&(o=!1),ellog=document.getElementById("log"),"MozWebSocket"in window&&t===!1?r=new MozWebSocket(e):t===!1?r=new WebSocket(e):t===!0&&(r.send=function(e){"undefined"==typeof testing_send_queue&&(testing_send_queue=[]),testing_send_queue.push(e)}),r.onopen=function(){if(d=!0,o===!1&&t===!1)authenticateTwistedDjango(_);else for(var e=0;e<c.length;e++)c[e]()},r.onclose=function(e){d=!1,f=!1,a=!1,u={},l!==!1&&l(e)},r.onmessage=function(e){response=JSON.parse(e.data);var n=new Array;for(var t in response){if("authenticate"===t&&o===!1){if("success"===response[t].authenticate){f=!0,p=response[t],d===!0&&(a=!0),user_name=response[t].name,permissions=response[t].permissions,user_number=response[t].user_number;for(var s=0;s<c.length;s++)c[s]()}else void 0!==response.authenticate.login_url&&(login_url=response.authenticate.login_url,window.location.href=login_url);return}if(commands=u[t],"undefined"!=typeof commands&&commands.length>0){for(var s=0;s<commands.length;s++)commands[s].listener(response[t]),commands[s].run_once===!0&&n.push(s);if(n.length>0){for(var s=n.length;s>=0;s--)u[t].splice(n[s],1);u[t]=commands}n=new Array}}};var _={echo_alert:function(e){alert(e.message)},echo_test:function(){r.on("echo_test",echo_alert,!1),r.send(JSON.stringify({echo_test:{message:"Hello, World!"}}))},is_authenticated:function(){return f},auth_info:function(){return p},is_connected:function(){return d},onready:function(e){a===!0?e():c.push(e)},on:function(e,n,o){"undefined"==typeof u&&(u={}),"undefined"==typeof u[e]&&(u[e]=new Array),u[e].push({listener:n,run_once:o})},send:function(e){r.send(e)},onclose:function(e){l=e}};return _};